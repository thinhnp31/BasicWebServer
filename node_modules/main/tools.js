"use strict";

var extend = require('util')._extend;

exports.load = function(argv, markdown) {
	var self = {};

	// Call a function and return self for chaining purposes
	function returnSelf(fn) {
		return function() {
			fn.apply(null, arguments);
			return self;
		};
	}

	// Options
	var optparser = require('./optparser').parse(argv, markdown);
	self.all = optparser.options;
	self.pos = optparser.options._;

	// Tools
	self.exit = process.exit;
	self.out = process.stdout;
	self.cout = returnSelf(console.log);
	self.err = process.stderr;
	self.cerr = returnSelf(console.error);

	// Asserts
	self.assert = require('assert'); // standard Node.js assert library

	// Extend the option parser's getValue $('') functionality with these tools
	return extend(optparser.getValue, self);
};
